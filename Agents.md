# AGENTS Guidelines for This Repository

This repository maintains a catalog of Dev Container Features under `src/` with
accompanying smoke tests under `test/`. When iterating with an agent, align with
the automation and structures already in place so the existing features continue
to build and test cleanly.

## Repository Layout
- `src/<feature>/` holds the feature manifest (`devcontainer-feature.json`), the
  installer (`install.sh`), and any helper assets.
- `test/<feature>/` mirrors each feature with autogenerated checks plus optional
  scenario scripts; `_global/` contains cross-feature scenarios shared by CI.
- Release automation (release-please) writes all `CHANGELOG.md` filesâ€”leave them
  untouched even when adding or updating features.

## Working Loop
1. Use a Linux shell or dev container with Docker available; the feature tests
   run containers per scenario.
2. Install the Dev Containers CLI once per session:
   ```
   npm install -g @devcontainers/cli
   ```
3. For targeted changes, run the autogenerated tests against at least one base
   image (CI covers `debian:latest`, `ubuntu:latest`, and
   `mcr.microsoft.com/devcontainers/base:ubuntu`):
   ```
   devcontainer features test --skip-scenarios -f <feature> -i debian:latest .
   ```
4. Execute the matching scenario suite when you change scripts, tests, or shared
   helpers:
   ```
   devcontainer features test -f <feature> --skip-autogenerated .
   ```
5. Only run the global scenarios when a change impacts shared behavior:
   ```
   devcontainer features test --global-scenarios-only .
   ```

## Coding Conventions
- Shell installers are Bash scripts that begin with `#!/usr/bin/env bash`, use
  `set -e`, and provide helper functions (`check_packages`, `apt_get_update`,
  etc.). Follow the closest existing feature and avoid introducing new patterns
  unless necessary. Prefer upstream Linux package registries (e.g. `apt`) before
  falling back to project release archives (GitHub, GitLab, etc.), and support
  version selectors like `stable`, `latest`, and `nightly` by resolving them to
  explicit versions at install time.
- Keep JSON formatted with four-space indentation, stable key ordering, and
  double-quoted strings.
- Default to ASCII text; add concise comments only when they explain non-obvious
  behavior or deviations from the common pattern.
- Place new scripts or assets beside the feature that needs them and mirror the
  directory structure under `test/`.

## Pre-PR Checklist
- [ ] Autogenerated tests pass for every touched feature/base image combo.
- [ ] Scenario tests (feature-level and global) are re-run when relevant code
      changes.
- [ ] No `CHANGELOG.md` files were edited; release-please will update them.
- [ ] All new or modified scripts are executable where required
      (`install.sh`, scenario runners, etc.).

Sticking to these notes keeps the CI matrix green and ensures new features look
and behave like the rest of the catalog. When unsure, open a similar feature in
`src/` and copy its approach.
